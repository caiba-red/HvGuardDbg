# HvGuardDbg  

**HvGuardDbg** 是一款基于 Intel VT-x / EPT 的虚拟化调试保护框架，面向 Windows 平台下的反调试研究、逆向工程分析及内核级安全测试场景。

本项目通过运行于 **VMX Root 模式** 的虚拟化控制层，在操作系统之下建立一层透明执行管理机制，从而实现调试器防护与反检测能力增强。

---

## 📌 项目概述

HvGuardDbg 依托以下核心技术构建：

- Intel VT-x 虚拟化扩展
- EPT（Extended Page Tables）二级页表机制
- VM-Exit 拦截与精细化分发
- 异常注入与异常路径控制
- 硬件断点寄存器虚拟化

目标是在复杂反调试环境下，为研究人员提供一个**稳定、低暴露、高兼容性**的调试保护环境。

---

## 🖥 支持平台

| 项目 | 要求 |
|------|------|
| 操作系统 | Windows 10 / 11（建议 22H2 及以上） |
| 处理器 | Intel 第 11 / 12 / 13 代 Core 系列 |
| 虚拟化支持 | 必须开启 VT-x 与 EPT |

> ⚠ 当前版本仅支持 Intel VT-x 架构，AMD SVM 支持已列入开发计划。

---

## 🚀 核心功能

### 1️⃣ 虚拟化保护层

- VMX Root 模式运行
- EPT 页级内存访问控制
- 执行页替换与动态 Hook
- 精细化 VM-Exit 分发机制
- TSC 时间补偿（抗时间检测）
- 可控异常注入

---

### 2️⃣ 调试器防护能力

- 硬件断点（DR0–DR7）虚拟化隐藏
- 软件断点透明重映射
- 异常过滤与重写
- 调试窗口行为保护
- 调试状态一致性伪装

---

### 3️⃣ 反反调试能力

- 虚拟化存在性隐藏
- 抗 TSC 时间差检测
- VM 状态伪装
- 调试标志一致性维护
- 常见反调试机制对抗支持

---

## 🔄 典型使用流程

1. 启动 HvGuardDbg
2. 启动调试器（如 WinDbg / CE DBG 等）
3. 接管目标进程
4. 默认启用以下保护：

   - 隐藏调试断点
   - 抛异常绕过
   - 调试窗口行为保护

5. 调试结束后请退出接管并卸载 Hook

---

## ⚠ 注意事项

- 驱动加载后将持续占用 VT 资源
- 不调试时建议退出接管并卸载
- 使用前请保存重要文件，避免异常蓝屏导致数据丢失
- 本工具仅用于合法的安全研究与测试用途

---

## 🛠 开发路线（Roadmap）

### ✅ 单线程调试模式（规划中）

- 线程级 VM-Exit 控制
- 指定线程 EPT Hook 生效控制
- 多线程异常隔离
- DR 寄存器线程级虚拟化

---

### ⏳ AMD SVM 支持（规划中）

计划支持：

- AMD SVM 虚拟化架构
- VMCB 结构适配
- NPT（二级页表）Hook 机制
- Exit 分发逻辑重构

---

## 👥 维护说明

由于作者时间有限，当前版本源码已交由好友持续维护与完善，包括：

- 蓝屏稳定性修复
- 结构重构优化
- 性能改进
- 兼容性增强

后续版本将以稳定性与跨平台支持为优先目标。

---

## 📖 适用场景

- 逆向工程分析
- 驱动级调试
- 反调试研究
- 安全对抗测试

---

## 📜 免责声明

本项目仅供安全研究、技术交流与合法测试用途。  
请在符合当地法律法规的前提下使用本工具。  
因不当使用所产生的任何后果由使用者自行承担。

---

**HvGuardDbg — 基于硬件虚拟化的调试保护框架**
